# åœ¨å¼€å‘ CPU å¡æ—¶ä½¿ç”¨ CryptoJS å¯¹ 16 è¿›åˆ¶å­—ç¬¦ä¸²è®¡ç®— DES æ—¶çš„é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

## èƒŒæ™¯

åœ¨å¼€å‘ CPU å¡æ—¶éœ€è¦ä½¿ç”¨ DES è®¡ç®—è¿‡ç¨‹å¯†é’¥ï¼Œç½‘ä¸Šæ‰¾åˆ°çš„ä»£ç ç¤ºä¾‹å¤§éƒ¨åˆ†æ˜¯ java çš„ï¼Œå°è¯•ä½¿ç”¨ CryptoJS è®¡ç®—ä½†æ˜¯å¾—åˆ°çš„å¯†æ–‡ä¸å¯¹ï¼ŒæœŸæœ›æ˜¯ 8 å­—èŠ‚ä½†æ˜¯å´å¾—åˆ°äº† 24 å­—èŠ‚çš„ç»“æœã€‚

å‡ºç°é—®é¢˜çš„ä¸»è¦åŸå› æ˜¯åº“æœ¬èº«æ–‡æ¡£çš„ä¸å®Œå–„å’Œå¯¹åŠ å¯†ç›¸å…³å†…å®¹çš„ä¸äº†è§£ï¼Œè€Œä¸”ç½‘ä¸Šä¹Ÿæ²¡æœ‰æœåˆ°ä½¿ç”¨ js å¯¹ 16 è¿›åˆ¶å­—ç¬¦ä¸²è®¡ç®— des çš„ç¤ºä¾‹ã€‚

å…³äºå¯¹ç§°å’Œéå¯¹ç§°åŠ å¯†ã€DES ç›¸å…³çš„çŸ¥è¯†è¿™é‡Œä¸èµ˜è¿°ï¼Œå¯è§æœ«å°¾çš„å‚è€ƒé“¾æ¥ã€‚

## æœŸæœ›

![](æµ‹è¯•å·¥å…·ç»“æœ.png)

## å°è¯•ä½¿ç”¨æœåˆ°çš„ä»£ç 

[åŸå§‹ä»£ç åœ¨è¿™ï¼ˆé”™è¯¯ä»£ç ï¼‰](des2.js)

**è¿è¡Œç»“æœ**

```
$ node des2.js
åŸæ–‡ï¼š 1234800000000000
å¯†é’¥ï¼š 9955551111555599
å¯†æ–‡ï¼š oSDP1wMIioLR6IdlSECczyYYEYrA27uX
å¯†æ–‡è§£å¯†ï¼š 1234800000000000
```

## ç»“æœåˆ†æ

1. å¯†æ–‡å¯ä»¥è§£å¯†å¾—åˆ°åŸæ–‡ï¼Œè¯´æ˜è¿™æ®µä»£ç æœ¬èº«æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œåªæ˜¯æˆ‘ä½¿ç”¨çš„æ–¹å¼ä¸å¯¹

2. å¯†æ–‡ä¸æ˜¯æˆ‘æœŸæœ›çš„ 16 è¿›åˆ¶å­—ç¬¦ä¸²è€Œæ˜¯ Base64 å­—ç¬¦ä¸²ï¼Œéœ€è¦ä¿®æ”¹æˆ 16 è¿›åˆ¶å­—ç¬¦ä¸²

   - å°†åŠ å¯†å‡½æ•° `encryptByDES()` è¿”å›å€¼ `encrypted.toString()` æ›¿æ¢æˆ `encrypted.ciphertext.toString()`

   - å°†è§£å¯†å‡½æ•° `decryptByDES()` ä¸­çš„å¯†æ–‡ `CryptoJS.enc.Base64.parse(ciphertext)` æ›¿æ¢æˆ `CryptoJS.enc.Hex.parse(ciphertext)`

   - ä¿®æ”¹åçš„ç»“æœï¼š

     ```
     åŸæ–‡ï¼š 1234800000000000
     å¯†é’¥ï¼š 9955551111555599
     å¯†æ–‡ï¼š a120cfd703088a82d1e8876548409ccf2618118ac0dbbb97
     å¯†æ–‡è§£å¯†ï¼š 1234800000000000
     ```

3. æŸ¥çœ‹ä»£ç å‘ç°ä½¿ç”¨äº† `CryptoJS.enc.Utf8.parse` è§£æå¯†é’¥å­—ç¬¦ä¸²ï¼Œä¹Ÿå°±æ˜¯æŒ‰ç…§ utf8 ç¼–ç è§£æï¼Œè€Œæˆ‘çš„å¯†é’¥æ˜¯ 16 è¿›åˆ¶å­—ç¬¦ä¸²ï¼Œå› æ­¤æ­£ç¡®çš„ç”¨æ³•åº”è¯¥æ˜¯ `CryptoJS.enc.Hex.parse`

4. ä»£ç ä¸­åªæŠŠå¯†é’¥å­—ç¬¦ä¸²æ ¹æ® `utf8`ç¼–ç è§£æï¼ŒåŸæ–‡ `message` æ˜¯ç›´æ¥ä½œä¸º `CryptoJS.DES.encrypt` çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œè¿™é‡ŒçŒœæƒ³ CryptoJS å†…éƒ¨é»˜è®¤æ˜¯å°†åŸæ–‡å­—ç¬¦ä¸²æŒ‰ç…§ `utf8` è§£æåå†è¿›è¡Œ DES åŠ å¯†ã€‚æµ‹è¯•åå‘ç°ä½¿ç”¨ `CryptoJS.enc.Utf8.parse(message)` æ›¿æ¢ `message` æ—¶å¯†æ–‡ä¸ä¼šæœ‰å˜åŒ–ï¼Œè¯´æ˜å‰é¢çš„çŒœæƒ³æ˜¯å¯¹çš„ï¼Œå› æ­¤è¿™é‡Œéœ€è¦å°†åŸæ–‡ä¹Ÿæ”¹æˆæŒ‰ç…§ 16 è¿›åˆ¶ç¼–ç å¤„ç†

   - å°†åŠ å¯†å‡½æ•° `encryptByDES()` ä¸­çš„åŸæ–‡ `message` æ›¿æ¢æˆ `messageHex = CryptoJS.enc.Hex.parse(message)`

   - å°†è§£å¯†å‡½æ•° `decryptByDES()` ä¸­çš„åŸæ–‡ `decrypted.toString(CryptoJS.enc.Utf8)` æ›¿æ¢æˆ `decrypted.toString(CryptoJS.enc.Hex)`

   - ä¿®æ”¹åçš„ç»“æœï¼š

     ```
      åŸæ–‡ï¼š 1234800000000000
      å¯†é’¥ï¼š 9955551111555599
      å¯†æ–‡ï¼š d2affb829749c6f6f391dd89b1736b72
      å¯†æ–‡è§£å¯†ï¼š 1234800000000000
     ```

5. è¿™æ—¶å€™ç»“æœçš„å‰ 8 bytesï¼ˆ`d2affb829749c6f6`ï¼‰å·²ç»æ˜¯æˆ‘è¦çš„ç»“æœäº†ï¼Œä½†å¥‡æ€ªçš„æ˜¯åŸæ–‡æ˜æ˜æ˜¯ 8 byte ä½†å¯†æ–‡å´æ˜¯ 16 byteï¼Œå°è¯•ä¿®æ”¹åŸæ–‡åå‘ç°ç»“å°¾çš„ 8 byte æ€»æ˜¯ `f391dd89b1736b72` ï¼Œå¯¹åº”çš„åŸæ–‡æ˜¯ `0808080808080808` ï¼Œè¯´æ˜ CryptoJS è‡ªåŠ¨åœ¨åŸæ–‡æœ«å°¾åŠ ä¸Šäº† 8 byte `0808080808080808` ï¼Œå› æ­¤æˆ‘ä¹Ÿåªéœ€è¦å¿½ç•¥æœ«å°¾ 8 byte å³å¯å¾—åˆ°æœŸæœ›çš„ç»“æœã€‚

   PSï¼šé»˜è®¤çš„è¡¥å…¨è¡Œä¸º

   - åœ¨åŸæ–‡å­—èŠ‚æ•°ä¸æ˜¯ 8 çš„å€æ•°æ—¶ä¼šåœ¨æœ«å°¾è¡¥ `01` ç›´åˆ°åŸæ–‡å­—èŠ‚æ•°ä¸º 8 çš„å€æ•°ï¼Œå¦‚ 12345678123456 => 12345678123456**01**
   - åŸæ–‡å­—èŠ‚å·²ç»æ˜¯ 8 çš„å€æ•°æ—¶ä¼šåœ¨æœ«å°¾è¡¥ `0808080808080808` ï¼Œå¦‚ 1234800000000000 => 1234800000000000**0808080808080808**

## é”™è¯¯åŸå› æ€»ç»“

1. **ç¼–ç æ ¼å¼é”™è¯¯**ï¼šé»˜è®¤æ˜¯æŒ‰ç…§çš„ utf8 ç¼–ç ï¼Œä½†ä¼ å…¥ 16 è¿›åˆ¶å­—ç¬¦ä¸²åº”è¯¥ä½¿ç”¨ Hex çš„ç¼–ç æ–¹å¼

2. **è¾“å…¥ 8 bytes çš„åŸæ–‡å´è·å¾—äº† 24 bytes çš„å¯†æ–‡**ï¼šå› ä¸ºæŒ‰ç…§ utf8 æ—¶åŸæ–‡ä¸­çš„ä¸€ä¸ªå­—ç¬¦ç¼–ç æˆ 1 ä¸ª byteï¼Œé•¿åº¦ä¸º 16 çš„å­—ç¬¦ä¸²ç¼–ç æˆ 16 byteï¼ŒåŠ ä¸Šè‡ªåŠ¨è¡¥å…¨çš„ 080808080808080 å³ 24 byte

   ```
   // æŒ‰ç…§ UTF8 ç¼–ç 
   1234800000000000 => 31323334383030303030303030303030 (16 bytes)

   // æŒ‰ç…§ Hexï¼ˆ16è¿›åˆ¶ï¼‰ ç¼–ç 
   1234800000000000 => 1234800000000000
   ```

## æœ€ç»ˆç»“æœ

[æœ€ç»ˆä»£ç åœ¨è¿™ï¼ˆæˆå“ï¼‰](des.js)

```
åŸæ–‡ï¼š 1234800000000000
å¯†é’¥ï¼š 9955551111555599
å¯†æ–‡ï¼š d2affb829749c6f6
å¯†æ–‡è§£å¯†ï¼š 1234800000000000
```

**æœ‰è¶£çš„äº‹æƒ…æ˜¯æˆ‘æ‰¾åˆ°çš„è¿™ä¸ªä»£ç ç‰‡æ®µæ˜¯ 2013 å¹´å†™çš„ï¼Œè€Œä¸”ä»…ä»…ä¸€ä¸ª gist ä¾¿æœ‰ 40+ çš„ starï¼Œé—´æ¥è¯´æ˜äº†å¤§å®¶éƒ½ä¸çŸ¥é“æ€ä¹ˆç”¨ `CryptoJS` ã€‚ã€‚ã€‚ğŸ˜Š**

## å‚è€ƒ

> [crypto-js](https://github.com/brix/crypto-js)
>
> [åœ¨çº¿æµ‹è¯•å·¥å…·](http://www.jpwz.vip/tool/des.html)
>
> [æœåˆ°çš„ä»£ç ç‰‡æ®µ](https://gist.github.com/ufologist/5581486)
>
> [å¾®ä¿¡å°ç¨‹åº-JavaScript 3DES å¯¹ç§°åŠ å¯†ç®—æ³•åŠ å¯†ä½¿ç”¨](https://blog.csdn.net/gd6321374/article/details/105750232)
